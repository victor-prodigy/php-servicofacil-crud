# Como realizar avalia√ß√£o de prestador
_Exported on 10/20/2025 at 10:00:51 GMT-3 from Cursor (1.7.46)_

---

**User**

@https://trello.com/b/mjSYhzVd/gestao-de-projeto  de acordo com o trello como fazer o pbi "[SF-003] Realizar avalia√ß√£o de prestador" nesse projeto?

---

**Cursor**

Infelizmente, n√£o consegui acessar o conte√∫do do Trello board - a p√°gina n√£o carregou os recursos. No entanto, posso ajud√°-lo a implementar o PBI "[SF-003] Realizar avalia√ß√£o de prestador" analisando a estrutura atual do projeto.

Deixe-me explorar o c√≥digo existente para entender melhor a estrutura e propor uma solu√ß√£o:

Perfeito! Analisando o c√≥digo do projeto, posso te orientar sobre como implementar o **PBI "[SF-003] Realizar avalia√ß√£o de prestador"**. 

Notei que a **tabela `review` j√° existe no banco de dados** (linhas 142-154 do `lib/db.sql`), mas ainda n√£o h√° implementa√ß√£o da funcionalidade. Aqui est√° o guia completo:

## üìã Implementa√ß√£o do PBI [SF-003] - Realizar Avalia√ß√£o de Prestador

### üéØ Objetivo
Permitir que clientes avaliem prestadores ap√≥s a conclus√£o de um servi√ßo contratado.

### üìä Estrutura do Banco de Dados (J√° Existe)
A tabela `review` j√° est√° criada com:
- `review_id` - ID da avalia√ß√£o
- `contract_id` - Refer√™ncia ao contrato
- `cliente_id` - Cliente que avalia
- `rating` - Nota de 1 a 5 estrelas
- `comment` - Coment√°rio opcional
- `created_at` - Data da avalia√ß√£o

### üîß Arquivos a Criar/Modificar

#### **1. Backend - PHP**

**Criar: `php/servico/criar-avaliacao.php`**
```php
<?php
session_start();
header('Content-Type: application/json');

// Verificar se o usu√°rio est√° logado e √© cliente
if (!isset($_SESSION['usuario_id']) || $_SESSION['usuario_tipo'] !== 'cliente') {
    http_response_code(401);
    echo json_encode(['success' => false, 'message' => 'Acesso negado']);
    exit;
}

require_once '../conexao.php';

try {
    // Receber dados do POST
    $data = json_decode(file_get_contents('php://input'), true);
    $contract_id = $data['contract_id'] ?? null;
    $rating = $data['rating'] ?? null;
    $comment = $data['comment'] ?? '';
    $cliente_id = $_SESSION['cliente_id'];

    // Valida√ß√µes
    if (!$contract_id || !$rating) {
        throw new Exception('Dados obrigat√≥rios n√£o fornecidos');
    }

    if ($rating < 1 || $rating > 5) {
        throw new Exception('Nota deve estar entre 1 e 5');
    }

    // Verificar se o contrato pertence ao cliente e est√° conclu√≠do
    $sql_check = "SELECT c.contract_id, c.status, c.cliente_id 
                  FROM contract c 
                  WHERE c.contract_id = ? AND c.cliente_id = ?";
    $stmt_check = $pdo->prepare($sql_check);
    $stmt_check->execute([$contract_id, $cliente_id]);
    $contract = $stmt_check->fetch(PDO::FETCH_ASSOC);

    if (!$contract) {
        throw new Exception('Contrato n√£o encontrado ou voc√™ n√£o tem permiss√£o');
    }

    if ($contract['status'] !== 'completed') {
        throw new Exception('S√≥ √© poss√≠vel avaliar contratos conclu√≠dos');
    }

    // Verificar se j√° existe avalia√ß√£o para este contrato
    $sql_exists = "SELECT review_id FROM review WHERE contract_id = ? AND cliente_id = ?";
    $stmt_exists = $pdo->prepare($sql_exists);
    $stmt_exists->execute([$contract_id, $cliente_id]);
    
    if ($stmt_exists->fetch()) {
        throw new Exception('Voc√™ j√° avaliou este servi√ßo');
    }

    // Inserir avalia√ß√£o
    $sql_insert = "INSERT INTO review (contract_id, cliente_id, rating, comment) 
                   VALUES (?, ?, ?, ?)";
    $stmt_insert = $pdo->prepare($sql_insert);
    $stmt_insert->execute([$contract_id, $cliente_id, $rating, $comment]);

    echo json_encode([
        'success' => true,
        'message' => 'Avalia√ß√£o registrada com sucesso!',
        'review_id' => $pdo->lastInsertId()
    ]);

} catch (Exception $e) {
    http_response_code(400);
    echo json_encode([
        'success' => false,
        'message' => $e->getMessage()
    ]);
}
?>
```

**Criar: `php/servico/listar-avaliacoes-prestador.php`**
```php
<?php
session_start();
header('Content-Type: application/json');

require_once '../conexao.php';

try {
    $prestador_id = $_GET['prestador_id'] ?? null;

    if (!$prestador_id) {
        throw new Exception('ID do prestador n√£o fornecido');
    }

    // Buscar avalia√ß√µes do prestador
    $sql = "SELECT 
                r.review_id,
                r.rating,
                r.comment,
                r.created_at,
                u.name as cliente_nome,
                sr.titulo as servico_titulo,
                sr.categoria
            FROM review r
            INNER JOIN contract c ON r.contract_id = c.contract_id
            INNER JOIN cliente cl ON r.cliente_id = cl.id
            INNER JOIN user u ON cl.user_id = u.user_id
            INNER JOIN service_request sr ON c.request_id = sr.request_id
            WHERE c.service_provider_id = ?
            ORDER BY r.created_at DESC";
    
    $stmt = $pdo->prepare($sql);
    $stmt->execute([$prestador_id]);
    $avaliacoes = $stmt->fetchAll(PDO::FETCH_ASSOC);

    // Calcular m√©dia de avalia√ß√µes
    $sql_media = "SELECT AVG(r.rating) as media, COUNT(r.review_id) as total
                  FROM review r
                  INNER JOIN contract c ON r.contract_id = c.contract_id
                  WHERE c.service_provider_id = ?";
    $stmt_media = $pdo->prepare($sql_media);
    $stmt_media->execute([$prestador_id]);
    $estatisticas = $stmt_media->fetch(PDO::FETCH_ASSOC);

    echo json_encode([
        'success' => true,
        'avaliacoes' => $avaliacoes,
        'media' => round($estatisticas['media'], 1),
        'total' => $estatisticas['total']
    ]);

} catch (Exception $e) {
    http_response_code(400);
    echo json_encode([
        'success' => false,
        'message' => $e->getMessage()
    ]);
}
?>
```

**Criar: `php/servico/listar-contratos-cliente.php`**
```php
<?php
session_start();
header('Content-Type: application/json');

if (!isset($_SESSION['usuario_id']) || $_SESSION['usuario_tipo'] !== 'cliente') {
    http_response_code(401);
    echo json_encode(['success' => false, 'message' => 'Acesso negado']);
    exit;
}

require_once '../conexao.php';

try {
    $cliente_id = $_SESSION['cliente_id'];

    // Buscar contratos do cliente
    $sql = "SELECT 
                c.contract_id,
                c.status,
                c.created_at,
                sr.titulo,
                sr.categoria,
                u.name as prestador_nome,
                sp.specialty,
                sp.location,
                CASE 
                    WHEN r.review_id IS NOT NULL THEN 1
                    ELSE 0
                END as ja_avaliado
            FROM contract c
            INNER JOIN service_request sr ON c.request_id = sr.request_id
            INNER JOIN service_provider sp ON c.service_provider_id = sp.service_provider_id
            INNER JOIN user u ON sp.user_id = u.user_id
            LEFT JOIN review r ON c.contract_id = r.contract_id AND r.cliente_id = ?
            WHERE c.cliente_id = ?
            ORDER BY c.created_at DESC";
    
    $stmt = $pdo->prepare($sql);
    $stmt->execute([$cliente_id, $cliente_id]);
    $contratos = $stmt->fetchAll(PDO::FETCH_ASSOC);

    echo json_encode([
        'success' => true,
        'contratos' => $contratos
    ]);

} catch (Exception $e) {
    http_response_code(400);
    echo json_encode([
        'success' => false,
        'message' => $e->getMessage()
    ]);
}
?>
```

#### **2. Frontend - HTML**

**Criar: `client/servico/avaliar-prestador.html`**
```html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avaliar Prestador - Servi√ßoF√°cil</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="../../assets/css/forms.css" rel="stylesheet">
    <style>
        .star-rating {
            display: flex;
            gap: 10px;
            font-size: 2rem;
        }
        .star {
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s;
        }
        .star:hover,
        .star.active {
            color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3><i class="bi bi-star-fill"></i> Avaliar Prestador</h3>
                    </div>
                    <div class="card-body">
                        <div id="contratoInfo" class="mb-4">
                            <!-- Informa√ß√µes do contrato ser√£o carregadas aqui -->
                        </div>

                        <form id="formAvaliacao">
                            <div class="mb-4">
                                <label class="form-label fw-bold">Nota do Servi√ßo *</label>
                                <div class="star-rating" id="starRating">
                                    <i class="bi bi-star-fill star" data-rating="1"></i>
                                    <i class="bi bi-star-fill star" data-rating="2"></i>
                                    <i class="bi bi-star-fill star" data-rating="3"></i>
                                    <i class="bi bi-star-fill star" data-rating="4"></i>
                                    <i class="bi bi-star-fill star" data-rating="5"></i>
                                </div>
                                <input type="hidden" id="rating" name="rating" required>
                                <div class="invalid-feedback">Selecione uma nota</div>
                            </div>

                            <div class="mb-3">
                                <label for="comment" class="form-label">Coment√°rio (opcional)</label>
                                <textarea 
                                    class="form-control" 
                                    id="comment" 
                                    name="comment" 
                                    rows="4" 
                                    placeholder="Compartilhe sua experi√™ncia com este prestador..."
                                    maxlength="500"
                                ></textarea>
                                <div class="form-text">M√°ximo 500 caracteres</div>
                            </div>

                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-check-circle"></i> Enviar Avalia√ß√£o
                                </button>
                                <a href="../cliente-dashboard.html" class="btn btn-secondary">
                                    <i class="bi bi-x-circle"></i> Cancelar
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/avaliar-prestador.js"></script>
</body>
</html>
```

#### **3. Frontend - JavaScript**

**Criar: `assets/js/avaliar-prestador.js`**
```javascript
// Obter ID do contrato da URL
const urlParams = new URLSearchParams(window.location.search);
const contractId = urlParams.get('contract_id');

let selectedRating = 0;

// Inicializa√ß√£o
document.addEventListener('DOMContentLoaded', function() {
    if (!contractId) {
        alert('ID do contrato n√£o fornecido');
        window.location.href = '../cliente-dashboard.html';
        return;
    }

    carregarInfoContrato();
    inicializarEstrelas();
    inicializarFormulario();
});

// Carregar informa√ß√µes do contrato
async function carregarInfoContrato() {
    try {
        const response = await fetch(`../../php/servico/listar-contratos-cliente.php`);
        const data = await response.json();

        if (data.success) {
            const contrato = data.contratos.find(c => c.contract_id == contractId);
            
            if (!contrato) {
                throw new Error('Contrato n√£o encontrado');
            }

            if (contrato.ja_avaliado == 1) {
                alert('Voc√™ j√° avaliou este servi√ßo');
                window.location.href = '../cliente-dashboard.html';
                return;
            }

            if (contrato.status !== 'completed') {
                alert('Este contrato ainda n√£o foi conclu√≠do');
                window.location.href = '../cliente-dashboard.html';
                return;
            }

            // Exibir informa√ß√µes
            document.getElementById('contratoInfo').innerHTML = `
                <div class="alert alert-info">
                    <h5 class="mb-2"><i class="bi bi-info-circle"></i> Informa√ß√µes do Servi√ßo</h5>
                    <p class="mb-1"><strong>Servi√ßo:</strong> ${contrato.titulo}</p>
                    <p class="mb-1"><strong>Categoria:</strong> ${contrato.categoria}</p>
                    <p class="mb-1"><strong>Prestador:</strong> ${contrato.prestador_nome}</p>
                    <p class="mb-0"><strong>Especialidade:</strong> ${contrato.specialty || 'N√£o informada'}</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao carregar informa√ß√µes do contrato');
    }
}

// Sistema de estrelas
function inicializarEstrelas() {
    const stars = document.querySelectorAll('.star');
    const ratingInput = document.getElementById('rating');

    stars.forEach(star => {
        star.addEventListener('click', function() {
            selectedRating = parseInt(this.getAttribute('data-rating'));
            ratingInput.value = selectedRating;
            
            // Atualizar visual das estrelas
            stars.forEach(s => {
                const starRating = parseInt(s.getAttribute('data-rating'));
                if (starRating <= selectedRating) {
                    s.classList.add('active');
                } else {
                    s.classList.remove('active');
                }
            });
        });

        // Efeito hover
        star.addEventListener('mouseenter', function() {
            const hoverRating = parseInt(this.getAttribute('data-rating'));
            stars.forEach(s => {
                const starRating = parseInt(s.getAttribute('data-rating'));
                if (starRating <= hoverRating) {
                    s.style.color = '#ffc107';
                } else {
                    s.style.color = '#ddd';
                }
            });
        });
    });

    // Resetar ao sair do mouse
    document.getElementById('starRating').addEventListener('mouseleave', function() {
        stars.forEach(s => {
            const starRating = parseInt(s.getAttribute('data-rating'));
            if (starRating <= selectedRating) {
                s.style.color = '#ffc107';
            } else {
                s.style.color = '#ddd';
            }
        });
    });
}

// Enviar avalia√ß√£o
function inicializarFormulario() {
    document.getElementById('formAvaliacao').addEventListener('submit', async function(e) {
        e.preventDefault();

        if (selectedRating === 0) {
            alert('Por favor, selecione uma nota');
            return;
        }

        const formData = {
            contract_id: contractId,
            rating: selectedRating,
            comment: document.getElementById('comment').value.trim()
        };

        try {
            const response = await fetch('../../php/servico/criar-avaliacao.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            const data = await response.json();

            if (data.success) {
                alert('Avalia√ß√£o enviada com sucesso!');
                window.location.href = '../cliente-dashboard.html';
            } else {
                alert('Erro: ' + data.message);
            }
        } catch (error) {
            console.error('Erro:', error);
            alert('Erro ao enviar avalia√ß√£o');
        }
    });
}
```

#### **4. Modificar Dashboard do Cliente**

Adicione na tabela de contratos do `cliente-dashboard.html` (ap√≥s linha 76):
```html
<th>Avalia√ß√£o</th>
```

E no JavaScript `cliente-dashboard.js`, adicione bot√£o de avalia√ß√£o para contratos conclu√≠dos:
```javascript
// Adicionar coluna de avalia√ß√£o na tabela
if (contrato.status === 'completed' && !contrato.ja_avaliado) {
    html += `<td>
        <a href="./servico/avaliar-prestador.html?contract_id=${contrato.contract_id}" 
           class="btn btn-sm btn-warning">
            <i class="bi bi-star-fill"></i> Avaliar
        </a>
    </td>`;
} else if (contrato.ja_avaliado) {
    html += `<td><span class="badge bg-success">J√° avaliado</span></td>`;
} else {
    html += `<td><span class="badge bg-secondary">Pendente</span></td>`;
}
```

### ‚úÖ Checklist de Implementa√ß√£o

- [ ] Criar `php/servico/criar-avaliacao.php`
- [ ] Criar `php/servico/listar-avaliacoes-prestador.php`
- [ ] Criar `php/servico/listar-contratos-cliente.php`
- [ ] Criar `client/servico/avaliar-prestador.html`
- [ ] Criar `assets/js/avaliar-prestador.js`
- [ ] Modificar `cliente-dashboard.html` para incluir bot√£o de avalia√ß√£o
- [ ] Modificar `cliente-dashboard.js` para carregar contratos
- [ ] (Opcional) Exibir m√©dia de avalia√ß√µes no perfil do prestador

### üß™ Testes Recomendados

1. Cliente s√≥ pode avaliar contratos conclu√≠dos
2. Cliente n√£o pode avaliar o mesmo contrato duas vezes
3. Nota deve ser entre 1 e 5
4. Coment√°rio √© opcional
5. Visualizar avalia√ß√µes no perfil do prestador

Este √© um guia completo baseado na estrutura atual do seu projeto! üöÄ

```php
<?php
session_start();
header('Content-Type: application/json');

// Verificar se o usu√°rio est√° logado e √© cliente
if (!isset($_SESSION['usuario_id']) || $_SESSION['usuario_tipo'] !== 'cliente') {
    http_response_code(401);
    echo json_encode(['success' => false, 'message' => 'Acesso negado']);
    exit;
}

require_once '../conexao.php';

try {
    // Receber dados do POST
    $data = json_decode(file_get_contents('php://input'), true);
    $contract_id = $data['contract_id'] ?? null;
    $rating = $data['rating'] ?? null;
    $comment = $data['comment'] ?? '';
    $cliente_id = $_SESSION['cliente_id'];

    // Valida√ß√µes
    if (!$contract_id || !$rating) {
        throw new Exception('Dados obrigat√≥rios n√£o fornecidos');
    }

    if ($rating < 1 || $rating > 5) {
        throw new Exception('Nota deve estar entre 1 e 5');
    }

    // Verificar se o contrato pertence ao cliente e est√° conclu√≠do
    $sql_check = "SELECT c.contract_id, c.status, c.cliente_id 
                  FROM contract c 
                  WHERE c.contract_id = ? AND c.cliente_id = ?";
    $stmt_check = $pdo->prepare($sql_check);
    $stmt_check->execute([$contract_id, $cliente_id]);
    $contract = $stmt_check->fetch(PDO::FETCH_ASSOC);

    if (!$contract) {
        throw new Exception('Contrato n√£o encontrado ou voc√™ n√£o tem permiss√£o');
    }

    if ($contract['status'] !== 'completed') {
        throw new Exception('S√≥ √© poss√≠vel avaliar contratos conclu√≠dos');
    }

    // Verificar se j√° existe avalia√ß√£o para este contrato
    $sql_exists = "SELECT review_id FROM review WHERE contract_id = ? AND cliente_id = ?";
    $stmt_exists = $pdo->prepare($sql_exists);
    $stmt_exists->execute([$contract_id, $cliente_id]);
    
    if ($stmt_exists->fetch()) {
        throw new Exception('Voc√™ j√° avaliou este servi√ßo');
    }

    // Inserir avalia√ß√£o
    $sql_insert = "INSERT INTO review (contract_id, cliente_id, rating, comment) 
                   VALUES (?, ?, ?, ?)";
    $stmt_insert = $pdo->prepare($sql_insert);
    $stmt_insert->execute([$contract_id, $cliente_id, $rating, $comment]);

    echo json_encode([
        'success' => true,
        'message' => 'Avalia√ß√£o registrada com sucesso!',
        'review_id' => $pdo->lastInsertId()
    ]);

} catch (Exception $e) {
    http_response_code(400);
    echo json_encode([
        'success' => false,
        'message' => $e->getMessage()
    ]);
}
?>
```

```php
<?php
session_start();
header('Content-Type: application/json');

require_once '../conexao.php';

try {
    $prestador_id = $_GET['prestador_id'] ?? null;

    if (!$prestador_id) {
        throw new Exception('ID do prestador n√£o fornecido');
    }

    // Buscar avalia√ß√µes do prestador
    $sql = "SELECT 
                r.review_id,
                r.rating,
                r.comment,
                r.created_at,
                u.name as cliente_nome,
                sr.titulo as servico_titulo,
                sr.categoria
            FROM review r
            INNER JOIN contract c ON r.contract_id = c.contract_id
            INNER JOIN cliente cl ON r.cliente_id = cl.id
            INNER JOIN user u ON cl.user_id = u.user_id
            INNER JOIN service_request sr ON c.request_id = sr.request_id
            WHERE c.service_provider_id = ?
            ORDER BY r.created_at DESC";
    
    $stmt = $pdo->prepare($sql);
    $stmt->execute([$prestador_id]);
    $avaliacoes = $stmt->fetchAll(PDO::FETCH_ASSOC);

    // Calcular m√©dia de avalia√ß√µes
    $sql_media = "SELECT AVG(r.rating) as media, COUNT(r.review_id) as total
                  FROM review r
                  INNER JOIN contract c ON r.contract_id = c.contract_id
                  WHERE c.service_provider_id = ?";
    $stmt_media = $pdo->prepare($sql_media);
    $stmt_media->execute([$prestador_id]);
    $estatisticas = $stmt_media->fetch(PDO::FETCH_ASSOC);

    echo json_encode([
        'success' => true,
        'avaliacoes' => $avaliacoes,
        'media' => round($estatisticas['media'], 1),
        'total' => $estatisticas['total']
    ]);

} catch (Exception $e) {
    http_response_code(400);
    echo json_encode([
        'success' => false,
        'message' => $e->getMessage()
    ]);
}
?>
```

```php
<?php
session_start();
header('Content-Type: application/json');

if (!isset($_SESSION['usuario_id']) || $_SESSION['usuario_tipo'] !== 'cliente') {
    http_response_code(401);
    echo json_encode(['success' => false, 'message' => 'Acesso negado']);
    exit;
}

require_once '../conexao.php';

try {
    $cliente_id = $_SESSION['cliente_id'];

    // Buscar contratos do cliente
    $sql = "SELECT 
                c.contract_id,
                c.status,
                c.created_at,
                sr.titulo,
                sr.categoria,
                u.name as prestador_nome,
                sp.specialty,
                sp.location,
                CASE 
                    WHEN r.review_id IS NOT NULL THEN 1
                    ELSE 0
                END as ja_avaliado
            FROM contract c
            INNER JOIN service_request sr ON c.request_id = sr.request_id
            INNER JOIN service_provider sp ON c.service_provider_id = sp.service_provider_id
            INNER JOIN user u ON sp.user_id = u.user_id
            LEFT JOIN review r ON c.contract_id = r.contract_id AND r.cliente_id = ?
            WHERE c.cliente_id = ?
            ORDER BY c.created_at DESC";
    
    $stmt = $pdo->prepare($sql);
    $stmt->execute([$cliente_id, $cliente_id]);
    $contratos = $stmt->fetchAll(PDO::FETCH_ASSOC);

    echo json_encode([
        'success' => true,
        'contratos' => $contratos
    ]);

} catch (Exception $e) {
    http_response_code(400);
    echo json_encode([
        'success' => false,
        'message' => $e->getMessage()
    ]);
}
?>
```

```html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avaliar Prestador - Servi√ßoF√°cil</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="../../assets/css/forms.css" rel="stylesheet">
    <style>
        .star-rating {
            display: flex;
            gap: 10px;
            font-size: 2rem;
        }
        .star {
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s;
        }
        .star:hover,
        .star.active {
            color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3><i class="bi bi-star-fill"></i> Avaliar Prestador</h3>
                    </div>
                    <div class="card-body">
                        <div id="contratoInfo" class="mb-4">
                            <!-- Informa√ß√µes do contrato ser√£o carregadas aqui -->
                        </div>

                        <form id="formAvaliacao">
                            <div class="mb-4">
                                <label class="form-label fw-bold">Nota do Servi√ßo *</label>
                                <div class="star-rating" id="starRating">
                                    <i class="bi bi-star-fill star" data-rating="1"></i>
                                    <i class="bi bi-star-fill star" data-rating="2"></i>
                                    <i class="bi bi-star-fill star" data-rating="3"></i>
                                    <i class="bi bi-star-fill star" data-rating="4"></i>
                                    <i class="bi bi-star-fill star" data-rating="5"></i>
                                </div>
                                <input type="hidden" id="rating" name="rating" required>
                                <div class="invalid-feedback">Selecione uma nota</div>
                            </div>

                            <div class="mb-3">
                                <label for="comment" class="form-label">Coment√°rio (opcional)</label>
                                <textarea 
                                    class="form-control" 
                                    id="comment" 
                                    name="comment" 
                                    rows="4" 
                                    placeholder="Compartilhe sua experi√™ncia com este prestador..."
                                    maxlength="500"
                                ></textarea>
                                <div class="form-text">M√°ximo 500 caracteres</div>
                            </div>

                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-check-circle"></i> Enviar Avalia√ß√£o
                                </button>
                                <a href="../cliente-dashboard.html" class="btn btn-secondary">
                                    <i class="bi bi-x-circle"></i> Cancelar
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/avaliar-prestador.js"></script>
</body>
</html>
```

```javascript
// Obter ID do contrato da URL
const urlParams = new URLSearchParams(window.location.search);
const contractId = urlParams.get('contract_id');

let selectedRating = 0;

// Inicializa√ß√£o
document.addEventListener('DOMContentLoaded', function() {
    if (!contractId) {
        alert('ID do contrato n√£o fornecido');
        window.location.href = '../cliente-dashboard.html';
        return;
    }

    carregarInfoContrato();
    inicializarEstrelas();
    inicializarFormulario();
});

// Carregar informa√ß√µes do contrato
async function carregarInfoContrato() {
    try {
        const response = await fetch(`../../php/servico/listar-contratos-cliente.php`);
        const data = await response.json();

        if (data.success) {
            const contrato = data.contratos.find(c => c.contract_id == contractId);
            
            if (!contrato) {
                throw new Error('Contrato n√£o encontrado');
            }

            if (contrato.ja_avaliado == 1) {
                alert('Voc√™ j√° avaliou este servi√ßo');
                window.location.href = '../cliente-dashboard.html';
                return;
            }

            if (contrato.status !== 'completed') {
                alert('Este contrato ainda n√£o foi conclu√≠do');
                window.location.href = '../cliente-dashboard.html';
                return;
            }

            // Exibir informa√ß√µes
            document.getElementById('contratoInfo').innerHTML = `
                <div class="alert alert-info">
                    <h5 class="mb-2"><i class="bi bi-info-circle"></i> Informa√ß√µes do Servi√ßo</h5>
                    <p class="mb-1"><strong>Servi√ßo:</strong> ${contrato.titulo}</p>
                    <p class="mb-1"><strong>Categoria:</strong> ${contrato.categoria}</p>
                    <p class="mb-1"><strong>Prestador:</strong> ${contrato.prestador_nome}</p>
                    <p class="mb-0"><strong>Especialidade:</strong> ${contrato.specialty || 'N√£o informada'}</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao carregar informa√ß√µes do contrato');
    }
}

// Sistema de estrelas
function inicializarEstrelas() {
    const stars = document.querySelectorAll('.star');
    const ratingInput = document.getElementById('rating');

    stars.forEach(star => {
        star.addEventListener('click', function() {
            selectedRating = parseInt(this.getAttribute('data-rating'));
            ratingInput.value = selectedRating;
            
            // Atualizar visual das estrelas
            stars.forEach(s => {
                const starRating = parseInt(s.getAttribute('data-rating'));
                if (starRating <= selectedRating) {
                    s.classList.add('active');
                } else {
                    s.classList.remove('active');
                }
            });
        });

        // Efeito hover
        star.addEventListener('mouseenter', function() {
            const hoverRating = parseInt(this.getAttribute('data-rating'));
            stars.forEach(s => {
                const starRating = parseInt(s.getAttribute('data-rating'));
                if (starRating <= hoverRating) {
                    s.style.color = '#ffc107';
                } else {
                    s.style.color = '#ddd';
                }
            });
        });
    });

    // Resetar ao sair do mouse
    document.getElementById('starRating').addEventListener('mouseleave', function() {
        stars.forEach(s => {
            const starRating = parseInt(s.getAttribute('data-rating'));
            if (starRating <= selectedRating) {
                s.style.color = '#ffc107';
            } else {
                s.style.color = '#ddd';
            }
        });
    });
}

// Enviar avalia√ß√£o
function inicializarFormulario() {
    document.getElementById('formAvaliacao').addEventListener('submit', async function(e) {
        e.preventDefault();

        if (selectedRating === 0) {
            alert('Por favor, selecione uma nota');
            return;
        }

        const formData = {
            contract_id: contractId,
            rating: selectedRating,
            comment: document.getElementById('comment').value.trim()
        };

        try {
            const response = await fetch('../../php/servico/criar-avaliacao.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            const data = await response.json();

            if (data.success) {
                alert('Avalia√ß√£o enviada com sucesso!');
                window.location.href = '../cliente-dashboard.html';
            } else {
                alert('Erro: ' + data.message);
            }
        } catch (error) {
            console.error('Erro:', error);
            alert('Erro ao enviar avalia√ß√£o');
        }
    });
}
```

```html
<th>Avalia√ß√£o</th>
```

```javascript
// Adicionar coluna de avalia√ß√£o na tabela
if (contrato.status === 'completed' && !contrato.ja_avaliado) {
    html += `<td>
        <a href="./servico/avaliar-prestador.html?contract_id=${contrato.contract_id}" 
           class="btn btn-sm btn-warning">
            <i class="bi bi-star-fill"></i> Avaliar
        </a>
    </td>`;
} else if (contrato.ja_avaliado) {
    html += `<td><span class="badge bg-success">J√° avaliado</span></td>`;
} else {
    html += `<td><span class="badge bg-secondary">Pendente</span></td>`;
}
```

---

**User**

@cliente-dashboard.js "// Adicionar coluna de avalia√ß√£o na tabela
if (contrato.status === 'completed' && !contrato.ja_avaliado) {
    html += `<td>
        <a href="./servico/avaliar-prestador.html?contract_id=${contrato.contract_id}" 
           class="btn btn-sm btn-warning">
            <i class="bi bi-star-fill"></i> Avaliar
        </a>
    </td>`;
} else if (contrato.ja_avaliado) {
    html += `<td><span class="badge bg-success">J√° avaliado</span></td>`;
} else {
    html += `<td><span class="badge bg-secondary">Pendente</span></td>`;
}" onde adicionar isso no cliente-dashboard.js

---

**Cursor**

Perfeito! Vou ajud√°-lo a adicionar a funcionalidade de avalia√ß√£o no `cliente-dashboard.js`. Voc√™ precisa criar uma nova fun√ß√£o para carregar os **contratos** do cliente (diferente das solicita√ß√µes). Vou implementar isso:

Agora vou implementar as mudan√ßas necess√°rias:

```html
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Servi√ßoF√°cil - Dashboard Cliente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet" />
    <link href="../assets/css/dashboard.css" rel="stylesheet" />
  </head>
  <body>
    <div class="container mt-4">
      <div class="row">
        <div class="col-12">
          <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
            <div class="container-fluid">
              <span class="navbar-brand">Servi√ßoF√°cil</span>
              <div class="d-flex">
                <span class="navbar-text me-3">
                  Bem-vindo(a), <span id="userName">Carregando...</span>
                </span>
                <button class="btn btn-outline-danger btn-sm" onclick="logout()">
                  <i class="bi bi-box-arrow-right"></i> Sair
                </button>
              </div>
            </div>
          </nav>
        </div>
      </div>
      
      <h1>Dashboard do Cliente</h1>
      <div id="dashboardContent" style="display: none;">
        
        <!-- A√ß√µes R√°pidas -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card bg-light">
              <div class="card-body">
                <h5 class="card-title">
                  <i class="bi bi-lightning-fill text-warning"></i>
                  A√ß√µes R√°pidas
                </h5>
                <div class="d-flex flex-wrap gap-2">
                  <a href="./servico/nova-solicitacao.html" class="btn btn-success">
                    <i class="bi bi-plus-circle-fill"></i>
                    Solicitar Servi√ßo
                  </a>
                  <a href="#" onclick="carregarServicos()" class="btn btn-info">
                    <i class="bi bi-arrow-clockwise"></i>
                    Atualizar Servi√ßos
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

          <div class="card">
            <div class="card-header">
              <h3>
                <i class="bi bi-journal-text"></i>
                Minhas Solicita√ß√µes de Servi√ßo
              </h3>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>T√≠tulo</th>
                      <th>Categoria</th>
                      <th>Prazo</th>
                      <th>Or√ßamento</th>
                      <th>Status</th>
                      <th>Data</th>
                      <th>A√ß√µes</th>
                    </tr>
                  </thead>
                  <tbody id="solicitacoesTable">
                    <!-- Solicita√ß√µes ser√£o carregadas aqui via JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Se√ß√£o de Contratos (para avalia√ß√£o) -->
        <div class="mt-4">
          <div class="card">
            <div class="card-header">
              <h3>
                <i class="bi bi-file-earmark-text"></i>
                Meus Contratos
              </h3>
              <p class="mb-0 text-muted">Acompanhe seus contratos e avalie os prestadores</p>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Servi√ßo</th>
                      <th>Prestador</th>
                      <th>Categoria</th>
                      <th>Status</th>
                      <th>Data</th>
                      <th>Avalia√ß√£o</th>
                    </tr>
                  </thead>
                  <tbody id="contratosTable">
                    <!-- Contratos ser√£o carregados aqui via JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Se√ß√£o de Servi√ßos Dispon√≠veis (Visualiza√ß√£o) -->
        <div class="mt-4">
          <div class="card">
            <div class="card-header">
              <h3>
                <i class="bi bi-shop"></i>
                Servi√ßos Dispon√≠veis
              </h3>
              <p class="mb-0 text-muted">Explore servi√ßos oferecidos pelos prestadores</p>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>T√≠tulo</th>
                      <th>Categoria</th>
                      <th>Pre√ßo</th>
                      <th>Status</th>
                      <th>Data</th>
                      <th>A√ß√µes</th>
                    </tr>
                  </thead>
                  <tbody id="servicosTable">
                    <!-- Servi√ßos ser√£o carregados aqui via JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      
      <!-- Bot√µes de A√ß√£o Fixos -->
      <div class="mt-4 d-flex gap-2 flex-wrap">
        <a href="./servico/nova-solicitacao.html" class="btn btn-success">
          <i class="bi bi-plus-circle-fill"></i>
          Solicitar Novo Servi√ßo
        </a>
        <button onclick="carregarServicos()" class="btn btn-info">
          <i class="bi bi-arrow-clockwise"></i>
          Atualizar Lista
        </button>
      </div>
    </div>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <!-- Custom JS -->
    <script src="../assets/js/cliente-dashboard.js"></script>
  </body>
</html>

```

Agora vou adicionar a fun√ß√£o para carregar contratos no JavaScript:

```javascript
document.addEventListener('DOMContentLoaded', function () {
    checkAuthentication();
});

async function checkAuthentication() {
    try {
        const response = await fetch('../php/cliente/cliente-dashboard.php');
        const data = await response.json();

        if (!data.authenticated) {
            // Se n√£o estiver autenticado, redireciona para a p√°gina de login
            alert(data.message);
            window.location.href = './login/index.html';
            return;
        }

        // Se estiver autenticado, mostra o conte√∫do e atualiza o nome do usu√°rio
        document.getElementById('userName').textContent = data.nome;
        document.getElementById('dashboardContent').style.display = 'block';

        // Carregar a lista de servi√ßos, solicita√ß√µes e contratos
        carregarServicos();
        carregarSolicitacoes();
        carregarContratos();

    } catch (error) {
        console.error('Erro ao verificar autentica√ß√£o:', error);
        alert('Erro ao carregar a p√°gina. Por favor, tente novamente.');
        window.location.href = './login/index.html';
    }
}

async function carregarServicos() {
    try {
        const response = await fetch('../php/servico/listar-servico.php');
        const data = await response.json();

        if (!data.success) {
            throw new Error(data.message);
        }

        const tableBody = document.getElementById('servicosTable');
        tableBody.innerHTML = ''; // Limpar tabela

        if (data.servicos.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center text-muted">
                        <i class="bi bi-inbox"></i> 
                        Nenhum servi√ßo dispon√≠vel no momento.
                    </td>
                </tr>
            `;
            return;
        }

        data.servicos.forEach(servico => {
            const row = document.createElement('tr');

            // Formatar data
            const data_formatada = new Date(servico.data_postagem).toLocaleDateString('pt-BR');

            // Definir classe do status
            const statusClass = getStatusClass(servico.status);

            // Formatar or√ßamento
            const orcamento = servico.orcamento ?
                new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(servico.orcamento) : 'A combinar';

            row.innerHTML = `
                <td>
                    <strong>${servico.titulo}</strong>
                    <br>
                    <small class="text-muted">Por: ${servico.prestador_nome || 'Prestador'}</small>
                </td>
                <td>
                    <span class="badge bg-info">${servico.categoria}</span>
                </td>
                <td>${orcamento}</td>
                <td><span class="badge ${statusClass}">${getStatusText(servico.status)}</span></td>
                <td>
                    <small>${data_formatada}</small>
                </td>
                <td>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-primary" 
                                onclick="verDetalhesServicoPublicado(${servico.id})" 
                                title="Ver detalhes">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-success" 
                                onclick="contratarServico(${servico.id})" 
                                title="Contratar">
                            <i class="bi bi-cart-plus"></i>
                        </button>
                    </div>
                </td>
            `;

            tableBody.appendChild(row);
        });

    } catch (error) {
        console.error('Erro ao carregar servi√ßos:', error);
        const tableBody = document.getElementById('servicosTable');
        tableBody.innerHTML = `
            <tr>
                <td colspan="6" class="text-center text-danger">
                    <i class="bi bi-exclamation-triangle"></i> 
                    Erro ao carregar servi√ßos: ${error.message}
                </td>
            </tr>
        `;
    }
}

function getStatusClass(status) {
    const statusClasses = {
        'aberto': 'bg-success',
        'em_andamento': 'bg-warning',
        'concluido': 'bg-info',
        'cancelado': 'bg-danger'
    };
    return statusClasses[status] || 'bg-secondary';
}

async function excluirServico(id) {
    if (!confirm('Tem certeza que deseja excluir este servi√ßo?')) {
        return;
    }

    try {
        const formData = new FormData();
        formData.append('servico_id', id);

        const response = await fetch('../php/servico/apaga-servico.php', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (data.success) {
            alert('Servi√ßo exclu√≠do com sucesso!');
            carregarServicos(); // Recarregar a tabela
        } else {
            throw new Error(data.message);
        }

    } catch (error) {
        console.error('Erro ao excluir servi√ßo:', error);
        alert('Erro ao excluir servi√ßo: ' + error.message);
    }
}

function logout() {
    // Limpar dados da sess√£o no localStorage
    localStorage.clear();

    // Fazer requisi√ß√£o para destruir a sess√£o no servidor
    fetch('../php/logout.php')
        .then(() => {
            // Redirecionar para a p√°gina de login
            window.location.href = './login/index.html';
        })
        .catch(error => {
            console.error('Erro ao fazer logout:', error);
            // Mesmo com erro, redireciona para garantir que o usu√°rio saia
            window.location.href = './login/index.html';
        });
}

// Fun√ß√£o para carregar solicita√ß√µes de servi√ßo
async function carregarSolicitacoes() {
    try {
        const response = await fetch('../php/servico/listar-solicitacoes.php');
        const data = await response.json();

        const tableBody = document.getElementById('solicitacoesTable');
        tableBody.innerHTML = ''; // Limpar tabela

        if (!data.success || data.solicitacoes.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="text-center text-muted">
                        <i class="bi bi-inbox"></i> 
                        Nenhuma solicita√ß√£o de servi√ßo encontrada.
                        <br>
                        <a href="./servico/nova-solicitacao.html" class="btn btn-success btn-sm mt-2">
                            <i class="bi bi-plus-circle"></i> Fazer primeira solicita√ß√£o
                        </a>
                    </td>
                </tr>
            `;
            return;
        }

        // Adicionar cada solicita√ß√£o √† tabela
        data.solicitacoes.forEach(solicitacao => {
            const row = document.createElement('tr');

            const dataFormatada = new Date(solicitacao.data_criacao).toLocaleDateString('pt-BR');
            const orcamento = solicitacao.orcamento_maximo ?
                `R$ ${parseFloat(solicitacao.orcamento_maximo).toFixed(2)}` :
                'Flex√≠vel';

            row.innerHTML = `
                <td>
                    <strong>${solicitacao.titulo}</strong>
                    <br>
                    <small class="text-muted">${solicitacao.cidade}</small>
                </td>
                <td>
                    <span class="badge bg-info">${solicitacao.categoria}</span>
                </td>
                <td>
                    <small>${solicitacao.prazo_desejado}</small>
                </td>
                <td>${orcamento}</td>
                <td>
                    <span class="badge ${getStatusClassSolicitacao(solicitacao.status)}">
                        ${getStatusTextSolicitacao(solicitacao.status)}
                    </span>
                </td>
                <td>
                    <small>${dataFormatada}</small>
                </td>
                <td>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-primary" 
                                onclick="verDetalhes(${solicitacao.id})" 
                                title="Ver detalhes">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-warning" 
                                onclick="editarSolicitacao(${solicitacao.id})" 
                                title="Editar">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                onclick="excluirSolicitacao(${solicitacao.id})" 
                                title="Excluir">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </td>
            `;

            tableBody.appendChild(row);
        });

    } catch (error) {
        console.error('Erro ao carregar solicita√ß√µes:', error);
        const tableBody = document.getElementById('solicitacoesTable');
        tableBody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center text-danger">
                    <i class="bi bi-exclamation-triangle"></i> 
                    Erro ao carregar solicita√ß√µes: ${error.message}
                </td>
            </tr>
        `;
    }
}

// Fun√ß√µes auxiliares para status das solicita√ß√µes
function getStatusClassSolicitacao(status) {
    const statusClasses = {
        'pendente': 'bg-warning text-dark',
        'em_andamento': 'bg-primary',
        'concluido': 'bg-success',
        'cancelado': 'bg-danger'
    };
    return statusClasses[status] || 'bg-secondary';
}

function getStatusTextSolicitacao(status) {
    const statusTexts = {
        'pendente': 'Pendente',
        'em_andamento': 'Em Andamento',
        'concluido': 'Conclu√≠do',
        'cancelado': 'Cancelado'
    };
    return statusTexts[status] || 'Desconhecido';
}

// Fun√ß√µes para a√ß√µes das solicita√ß√µes
function verDetalhes(id) {
    // Implementar modal ou p√°gina de detalhes
    alert(`Ver detalhes da solicita√ß√£o ${id} - Funcionalidade em desenvolvimento`);
}

function editarSolicitacao(id) {
    // Redirecionar para p√°gina de edi√ß√£o
    window.location.href = `./servico/altera-solicitacao.html?id=${id}`;
}

async function excluirSolicitacao(id) {
    if (!confirm('Tem certeza que deseja excluir esta solicita√ß√£o de servi√ßo?')) {
        return;
    }

    try {
        const formData = new FormData();
        formData.append('solicitacao_id', id);

        const response = await fetch('../php/servico/apaga-solicitacao.php', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (data.success) {
            alert('Solicita√ß√£o exclu√≠da com sucesso!');
            carregarSolicitacoes(); // Recarregar a tabela
        } else {
            throw new Error(data.message);
        }

    } catch (error) {
        console.error('Erro ao excluir solicita√ß√£o:', error);
        alert('Erro ao excluir solicita√ß√£o: ' + error.message);
    }
}

// Fun√ß√µes auxiliares para status dos servi√ßos publicados
function getStatusText(status) {
    const statusTexts = {
        'ativo': 'Ativo',
        'inativo': 'Inativo',
        'pausado': 'Pausado'
    };
    return statusTexts[status] || 'Desconhecido';
}

// Fun√ß√µes para a√ß√µes dos servi√ßos publicados (visualiza√ß√£o pelos clientes)
function verDetalhesServicoPublicado(id) {
    alert(`Ver detalhes do servi√ßo ${id} - Funcionalidade em desenvolvimento`);
}

function contratarServico(id) {
    alert(`Contratar servi√ßo ${id} - Funcionalidade em desenvolvimento`);
}
```

```javascript
document.addEventListener('DOMContentLoaded', function () {
    checkAuthentication();
});

async function checkAuthentication() {
    try {
        const response = await fetch('../php/cliente/cliente-dashboard.php');
        const data = await response.json();

        if (!data.authenticated) {
            // Se n√£o estiver autenticado, redireciona para a p√°gina de login
            alert(data.message);
            window.location.href = './login/index.html';
            return;
        }

        // Se estiver autenticado, mostra o conte√∫do e atualiza o nome do usu√°rio
        document.getElementById('userName').textContent = data.nome;
        document.getElementById('dashboardContent').style.display = 'block';

        // Carregar a lista de servi√ßos, solicita√ß√µes e contratos
        carregarServicos();
        carregarSolicitacoes();
        carregarContratos();

    } catch (error) {
        console.error('Erro ao verificar autentica√ß√£o:', error);
        alert('Erro ao carregar a p√°gina. Por favor, tente novamente.');
        window.location.href = './login/index.html';
    }
}

async function carregarServicos() {
    try {
        const response = await fetch('../php/servico/listar-servico.php');
        const data = await response.json();

        if (!data.success) {
            throw new Error(data.message);
        }

        const tableBody = document.getElementById('servicosTable');
        tableBody.innerHTML = ''; // Limpar tabela

        if (data.servicos.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center text-muted">
                        <i class="bi bi-inbox"></i> 
                        Nenhum servi√ßo dispon√≠vel no momento.
                    </td>
                </tr>
            `;
            return;
        }

        data.servicos.forEach(servico => {
            const row = document.createElement('tr');

            // Formatar data
            const data_formatada = new Date(servico.data_postagem).toLocaleDateString('pt-BR');

            // Definir classe do status
            const statusClass = getStatusClass(servico.status);

            // Formatar or√ßamento
            const orcamento = servico.orcamento ?
                new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(servico.orcamento) : 'A combinar';

            row.innerHTML = `
                <td>
                    <strong>${servico.titulo}</strong>
                    <br>
                    <small class="text-muted">Por: ${servico.prestador_nome || 'Prestador'}</small>
                </td>
                <td>
                    <span class="badge bg-info">${servico.categoria}</span>
                </td>
                <td>${orcamento}</td>
                <td><span class="badge ${statusClass}">${getStatusText(servico.status)}</span></td>
                <td>
                    <small>${data_formatada}</small>
                </td>
                <td>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-primary" 
                                onclick="verDetalhesServicoPublicado(${servico.id})" 
                                title="Ver detalhes">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-success" 
                                onclick="contratarServico(${servico.id})" 
                                title="Contratar">
                            <i class="bi bi-cart-plus"></i>
                        </button>
                    </div>
                </td>
            `;

            tableBody.appendChild(row);
        });

    } catch (error) {
        console.error('Erro ao carregar servi√ßos:', error);
        const tableBody = document.getElementById('servicosTable');
        tableBody.innerHTML = `
            <tr>
                <td colspan="6" class="text-center text-danger">
                    <i class="bi bi-exclamation-triangle"></i> 
                    Erro ao carregar servi√ßos: ${error.message}
                </td>
            </tr>
        `;
    }
}

function getStatusClass(status) {
    const statusClasses = {
        'aberto': 'bg-success',
        'em_andamento': 'bg-warning',
        'concluido': 'bg-info',
        'cancelado': 'bg-danger'
    };
    return statusClasses[status] || 'bg-secondary';
}

async function excluirServico(id) {
    if (!confirm('Tem certeza que deseja excluir este servi√ßo?')) {
        return;
    }

    try {
        const formData = new FormData();
        formData.append('servico_id', id);

        const response = await fetch('../php/servico/apaga-servico.php', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (data.success) {
            alert('Servi√ßo exclu√≠do com sucesso!');
            carregarServicos(); // Recarregar a tabela
        } else {
            throw new Error(data.message);
        }

    } catch (error) {
        console.error('Erro ao excluir servi√ßo:', error);
        alert('Erro ao excluir servi√ßo: ' + error.message);
    }
}

function logout() {
    // Limpar dados da sess√£o no localStorage
    localStorage.clear();

    // Fazer requisi√ß√£o para destruir a sess√£o no servidor
    fetch('../php/logout.php')
        .then(() => {
            // Redirecionar para a p√°gina de login
            window.location.href = './login/index.html';
        })
        .catch(error => {
            console.error('Erro ao fazer logout:', error);
            // Mesmo com erro, redireciona para garantir que o usu√°rio saia
            window.location.href = './login/index.html';
        });
}

// Fun√ß√£o para carregar solicita√ß√µes de servi√ßo
async function carregarSolicitacoes() {
    try {
        const response = await fetch('../php/servico/listar-solicitacoes.php');
        const data = await response.json();

        const tableBody = document.getElementById('solicitacoesTable');
        tableBody.innerHTML = ''; // Limpar tabela

        if (!data.success || data.solicitacoes.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="text-center text-muted">
                        <i class="bi bi-inbox"></i> 
                        Nenhuma solicita√ß√£o de servi√ßo encontrada.
                        <br>
                        <a href="./servico/nova-solicitacao.html" class="btn btn-success btn-sm mt-2">
                            <i class="bi bi-plus-circle"></i> Fazer primeira solicita√ß√£o
                        </a>
                    </td>
                </tr>
            `;
            return;
        }

        // Adicionar cada solicita√ß√£o √† tabela
        data.solicitacoes.forEach(solicitacao => {
            const row = document.createElement('tr');

            const dataFormatada = new Date(solicitacao.data_criacao).toLocaleDateString('pt-BR');
            const orcamento = solicitacao.orcamento_maximo ?
                `R$ ${parseFloat(solicitacao.orcamento_maximo).toFixed(2)}` :
                'Flex√≠vel';

            row.innerHTML = `
                <td>
                    <strong>${solicitacao.titulo}</strong>
                    <br>
                    <small class="text-muted">${solicitacao.cidade}</small>
                </td>
                <td>
                    <span class="badge bg-info">${solicitacao.categoria}</span>
                </td>
                <td>
                    <small>${solicitacao.prazo_desejado}</small>
                </td>
                <td>${orcamento}</td>
                <td>
                    <span class="badge ${getStatusClassSolicitacao(solicitacao.status)}">
                        ${getStatusTextSolicitacao(solicitacao.status)}
                    </span>
                </td>
                <td>
                    <small>${dataFormatada}</small>
                </td>
                <td>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-primary" 
                                onclick="verDetalhes(${solicitacao.id})" 
                                title="Ver detalhes">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-warning" 
                                onclick="editarSolicitacao(${solicitacao.id})" 
                                title="Editar">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                onclick="excluirSolicitacao(${solicitacao.id})" 
                                title="Excluir">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </td>
            `;

            tableBody.appendChild(row);
        });

    } catch (error) {
        console.error('Erro ao carregar solicita√ß√µes:', error);
        const tableBody = document.getElementById('solicitacoesTable');
        tableBody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center text-danger">
                    <i class="bi bi-exclamation-triangle"></i> 
                    Erro ao carregar solicita√ß√µes: ${error.message}
                </td>
            </tr>
        `;
    }
}

// Fun√ß√µes auxiliares para status das solicita√ß√µes
function getStatusClassSolicitacao(status) {
    const statusClasses = {
        'pendente': 'bg-warning text-dark',
        'em_andamento': 'bg-primary',
        'concluido': 'bg-success',
        'cancelado': 'bg-danger'
    };
    return statusClasses[status] || 'bg-secondary';
}

function getStatusTextSolicitacao(status) {
    const statusTexts = {
        'pendente': 'Pendente',
        'em_andamento': 'Em Andamento',
        'concluido': 'Conclu√≠do',
        'cancelado': 'Cancelado'
    };
    return statusTexts[status] || 'Desconhecido';
}

// Fun√ß√µes para a√ß√µes das solicita√ß√µes
function verDetalhes(id) {
    // Implementar modal ou p√°gina de detalhes
    alert(`Ver detalhes da solicita√ß√£o ${id} - Funcionalidade em desenvolvimento`);
}

function editarSolicitacao(id) {
    // Redirecionar para p√°gina de edi√ß√£o
    window.location.href = `./servico/altera-solicitacao.html?id=${id}`;
}

async function excluirSolicitacao(id) {
    if (!confirm('Tem certeza que deseja excluir esta solicita√ß√£o de servi√ßo?')) {
        return;
    }

    try {
        const formData = new FormData();
        formData.append('solicitacao_id', id);

        const response = await fetch('../php/servico/apaga-solicitacao.php', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();

        if (data.success) {
            alert('Solicita√ß√£o exclu√≠da com sucesso!');
            carregarSolicitacoes(); // Recarregar a tabela
        } else {
            throw new Error(data.message);
        }

    } catch (error) {
        console.error('Erro ao excluir solicita√ß√£o:', error);
        alert('Erro ao excluir solicita√ß√£o: ' + error.message);
    }
}

// Fun√ß√£o para carregar contratos do cliente
async function carregarContratos() {
    try {
        const response = await fetch('../php/servico/listar-contratos-cliente.php');
        const data = await response.json();

        const tableBody = document.getElementById('contratosTable');
        tableBody.innerHTML = ''; // Limpar tabela

        if (!data.success || data.contratos.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center text-muted">
                        <i class="bi bi-inbox"></i> 
                        Nenhum contrato encontrado.
                    </td>
                </tr>
            `;
            return;
        }

        // Adicionar cada contrato √† tabela
        data.contratos.forEach(contrato => {
            const row = document.createElement('tr');

            const dataFormatada = new Date(contrato.created_at).toLocaleDateString('pt-BR');
            
            // Definir badge de status
            let statusBadge = '';
            if (contrato.status === 'completed') {
                statusBadge = '<span class="badge bg-success">Conclu√≠do</span>';
            } else if (contrato.status === 'active') {
                statusBadge = '<span class="badge bg-primary">Ativo</span>';
            } else if (contrato.status === 'cancelled') {
                statusBadge = '<span class="badge bg-danger">Cancelado</span>';
            } else {
                statusBadge = '<span class="badge bg-secondary">Pendente</span>';
            }

            // Gerar coluna de avalia√ß√£o baseada no status
            let avaliacaoHtml = '';
            if (contrato.status === 'completed' && contrato.ja_avaliado == 0) {
                avaliacaoHtml = `
                    <a href="./servico/avaliar-prestador.html?contract_id=${contrato.contract_id}" 
                       class="btn btn-sm btn-warning">
                        <i class="bi bi-star-fill"></i> Avaliar
                    </a>
                `;
            } else if (contrato.ja_avaliado == 1) {
                avaliacaoHtml = '<span class="badge bg-success"><i class="bi bi-check-circle"></i> J√° avaliado</span>';
            } else {
                avaliacaoHtml = '<span class="badge bg-secondary">Aguardando conclus√£o</span>';
            }

            row.innerHTML = `
                <td>
                    <strong>${contrato.titulo}</strong>
                </td>
                <td>
                    ${contrato.prestador_nome}
                    <br>
                    <small class="text-muted">${contrato.specialty || 'Sem especialidade'}</small>
                </td>
                <td>
                    <span class="badge bg-info">${contrato.categoria}</span>
                </td>
                <td>${statusBadge}</td>
                <td>
                    <small>${dataFormatada}</small>
                </td>
                <td>${avaliacaoHtml}</td>
            `;

            tableBody.appendChild(row);
        });

    } catch (error) {
        console.error('Erro ao carregar contratos:', error);
        const tableBody = document.getElementById('contratosTable');
        tableBody.innerHTML = `
            <tr>
                <td colspan="6" class="text-center text-danger">
                    <i class="bi bi-exclamation-triangle"></i> 
                    Erro ao carregar contratos: ${error.message}
                </td>
            </tr>
        `;
    }
}

// Fun√ß√µes auxiliares para status dos servi√ßos publicados
function getStatusText(status) {
    const statusTexts = {
        'ativo': 'Ativo',
        'inativo': 'Inativo',
        'pausado': 'Pausado'
    };
    return statusTexts[status] || 'Desconhecido';
}

// Fun√ß√µes para a√ß√µes dos servi√ßos publicados (visualiza√ß√£o pelos clientes)
function verDetalhesServicoPublicado(id) {
    alert(`Ver detalhes do servi√ßo ${id} - Funcionalidade em desenvolvimento`);
}

function contratarServico(id) {
    alert(`Contratar servi√ßo ${id} - Funcionalidade em desenvolvimento`);
}
```

Excelente! Implementei a funcionalidade completa. Aqui est√° o resumo do que foi adicionado:

## ‚úÖ Altera√ß√µes Realizadas

### 1. **HTML (`cliente-dashboard.html`)**
Adicionei uma nova se√ß√£o "Meus Contratos" entre as solicita√ß√µes e os servi√ßos dispon√≠veis (linhas 88-118):
- Tabela com colunas: Servi√ßo, Prestador, Categoria, Status, Data e **Avalia√ß√£o**

### 2. **JavaScript (`cliente-dashboard.js`)**

#### **Linha 24:** Chamada da nova fun√ß√£o
```javascript
carregarContratos(); // Adicionada junto com carregarServicos() e carregarSolicitacoes()
```

#### **Linhas 330-418:** Nova fun√ß√£o `carregarContratos()`
Esta √© a fun√ß√£o completa que:
- Busca os contratos do cliente via API
- Para cada contrato, exibe as informa√ß√µes
- **Na coluna "Avalia√ß√£o" (linhas 370-382)**, aplica a l√≥gica que voc√™ perguntou:

```javascript
// Gerar coluna de avalia√ß√£o baseada no status
let avaliacaoHtml = '';
if (contrato.status === 'completed' && contrato.ja_avaliado == 0) {
    avaliacaoHtml = `
        <a href="./servico/avaliar-prestador.html?contract_id=${contrato.contract_id}" 
           class="btn btn-sm btn-warning">
            <i class="bi bi-star-fill"></i> Avaliar
        </a>
    `;
} else if (contrato.ja_avaliado == 1) {
    avaliacaoHtml = '<span class="badge bg-success"><i class="bi bi-check-circle"></i> J√° avaliado</span>';
} else {
    avaliacaoHtml = '<span class="badge bg-secondary">Aguardando conclus√£o</span>';
}
```

## üéØ Como Funciona

1. **Contrato conclu√≠do e N√ÉO avaliado** ‚Üí Mostra bot√£o amarelo "‚≠ê Avaliar"
2. **Contrato j√° avaliado** ‚Üí Mostra badge verde "‚úì J√° avaliado"  
3. **Contrato n√£o conclu√≠do** ‚Üí Mostra badge cinza "Aguardando conclus√£o"

Agora quando o cliente acessar o dashboard, ver√° a se√ß√£o de contratos com os bot√µes de avalia√ß√£o conforme o status! üöÄ

```javascript
carregarContratos(); // Adicionada junto com carregarServicos() e carregarSolicitacoes()
```

```javascript
// Gerar coluna de avalia√ß√£o baseada no status
let avaliacaoHtml = '';
if (contrato.status === 'completed' && contrato.ja_avaliado == 0) {
    avaliacaoHtml = `
        <a href="./servico/avaliar-prestador.html?contract_id=${contrato.contract_id}" 
           class="btn btn-sm btn-warning">
            <i class="bi bi-star-fill"></i> Avaliar
        </a>
    `;
} else if (contrato.ja_avaliado == 1) {
    avaliacaoHtml = '<span class="badge bg-success"><i class="bi bi-check-circle"></i> J√° avaliado</span>';
} else {
    avaliacaoHtml = '<span class="badge bg-secondary">Aguardando conclus√£o</span>';
}
```

